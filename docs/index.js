const noSleep=new NoSleep,tmpCanvas=document.createElement("canvas"),timeoverAudio=new Audio("mp3/warning1.mp3"),countdownAudio=new Audio("mp3/menu1.mp3"),alertAudio=new Audio("mp3/decision3.mp3"),alertSeconds=[1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4,3e4,6e4],nextAlerts=[6e4,6e4],timerIntervals=[0,0],startTimes=[0,0],remainingTimes=[0,0],countdowns=[!1,!1];let mute=!0;function stopTimer(){timeoverAudio.pause(),clearInterval(timerIntervals[0]),clearInterval(timerIntervals[1]),this.classList.add("d-none");const e=document.getElementById("restartButton");e.classList.remove("d-none"),document.getElementById("btn0").disabled?e.dataset.id=1:e.dataset.id=0}function restartTimer(){timeoverAudio.pause();const e=parseInt(this.dataset.id);this.classList.add("d-none"),document.getElementById("stopButton").classList.remove("d-none"),startTimes[e]=Date.now()+remainingTimes[e],timerIntervals[e]=setInterval(()=>{tick(e)},50)}function startTimer(){window.scroll(0,0),document.getElementById("stopButton").classList.remove("d-none"),document.getElementById("restartButton").classList.add("d-none");const t=parseInt(this.getAttribute("id").slice(-1));this.setAttribute("disabled","true");let e;if(t==0?(document.getElementById("btn1").removeAttribute("disabled"),e=1):(document.getElementById("btn0").removeAttribute("disabled"),e=0),clearInterval(timerIntervals[t]),countdowns[e]){const n=document.getElementById("timerHeader"+e),s=n.getElementsByTagName("input"),t=s[3].value||0;startTimes[e]=Date.now()+t*1e3;const o=(t-1)*1e3,i=alertSeconds.find(e=>o<e);nextAlerts[e]=i}else startTimes[e]=Date.now()+remainingTimes[e];timerIntervals[e]=setInterval(()=>{tick(e)},50)}function resetTimerBase(e){timerIntervals[e]&&clearInterval(timerIntervals[e]);const l=document.getElementById("timerHeader"+e),t=l.getElementsByTagName("input"),n=t[0].value||0,s=t[1].value||0,o=t[2].value||0,a=t[3].value||0,r=("00"+s).slice(-2),d=("00"+o).slice(-2),i=document.getElementById("btn"+e);if(n==0&&s==0&&o==0&&a!=0){countdowns[e]=!0;const t=("00"+a).slice(-2);i.textContent=n+":"+r+":"+t}else countdowns[e]=!1,i.textContent=n+":"+r+":"+d;const c=n*36e5+s*6e4+o*1e3;remainingTimes[e]=c,alertSeconds.forEach(t=>{t<c&&(nextAlerts[e]=t)}),resizeFontSize(i)}function resetTimer(e){e?resetTimerBase(e):(resetTimerBase(0),resetTimerBase(1))}function tick(e){const n=document.getElementById("btn"+e);let t=startTimes[e]-Date.now();if(remainingTimes[e]=t,t<0){const o=document.getElementById("timerHeader"+e),i=o.getElementsByTagName("input"),s=i[3].value||0;if(0<s)if(countdowns[e])t<-5e3?(timeoverAudio.pause(),clearInterval(timerIntervals[e])):mute||(timeoverAudio.loop=!0,timeoverAudio.play()),n.textContent="0:00:00";else{countdowns[e]=!0,t=s*1e3,remainingTimes[e]=t,startTimes[e]=Date.now()+t;const o=("00"+s).slice(-2);n.textContent="0:00:"+o,mute||countdownAudio.play();const i=alertSeconds.find(e=>e<t);nextAlerts[e]=i}else t<-5e3?(timeoverAudio.pause(),clearInterval(timerIntervals[e])):mute||(timeoverAudio.loop=!0,timeoverAudio.play()),n.textContent="0:00:00"}else{if(t<nextAlerts[e]){mute||alertAudio.play();const t=alertSeconds.indexOf(nextAlerts[e]);nextAlerts[e]=alertSeconds[t-1]}t+=1e3;const s=Math.floor(t/36e5),o=Math.floor(t%36e5/6e4),i=Math.floor(t%6e4/1e3),a=("00"+o).slice(-2),r=("00"+i).slice(-2);n.textContent=s+":"+a+":"+r}}function resizeFontSize(e){function m(e,t){const n=tmpCanvas.getContext("2d");n.font=t;const s=n.measureText(e);return s.width}function u(e,t,n,s){const o=e.split(`
`),a=t+"px "+n;let i=0;for(let e=0;e<o.length;e++){const t=m(o[e],a);i<t&&(i=t)}return[i,t*o.length*s]}function l(){const e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;return e<t?[e,t*.4]:[e*.45,t]}function c(e){const t=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),n=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom);return[t,n]}const t=getComputedStyle(e),d=t.fontFamily,n=parseFloat(t.fontSize),h=parseFloat(t.lineHeight)/n,o=l(),s=u(e.textContent,n,d,h),i=c(t),a=n*(o[0]-i[0])/s[0]*.9,r=n*(o[1]-i[1])/s[1]*.9;r<a?e.style.fontSize=r+"px":e.style.fontSize=a+"px"}function toggleBGM(){this.classList.contains("disabled")?(this.classList.remove("disabled"),timeoverAudio.loop=!1,timeoverAudio.play(),countdownAudio.play(),alertAudio.play(),mute=!1):(this.classList.add("disabled"),timeoverAudio.pause(),mute=!0)}noSleep.enable();const btn0=document.getElementById("btn0"),btn1=document.getElementById("btn1");resizeFontSize(btn0),resizeFontSize(btn1),window.addEventListener("resize",()=>{resizeFontSize(btn0),resizeFontSize(btn1)}),document.getElementById("toggleBGM").onclick=toggleBGM,document.getElementById("btn0").onclick=startTimer,document.getElementById("btn1").onclick=startTimer,document.getElementById("stopButton").onclick=stopTimer,document.getElementById("restartButton").onclick=restartTimer,document.getElementById("resetButton").onclick=()=>{resetTimer(0),resetTimer(1)},[...document.getElementById("timerHeader0").getElementsByTagName("input")].forEach(e=>{e.onchange=()=>{resetTimer(0)}}),[...document.getElementById("timerHeader1").getElementsByTagName("input")].forEach(e=>{e.onchange=()=>{resetTimer(1)}})